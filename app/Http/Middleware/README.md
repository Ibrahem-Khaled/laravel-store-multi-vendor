# API Middleware Documentation

## ูุธุงู ุงูู Middleware - Multi-Vendor Store API

### ๐ ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅูุดุงุก ูุธุงู middleware ูุชูุฏู ููุชุญูู ูู ุงููุตุงุฏูุฉ ูุญุงูุฉ ุงููุณุชุฎุฏู ูู API.

### ๐ง ุงูู Middleware ุงููุชุงุญุฉ

#### **1. ApiAuth**
- **ุงูููู**: `app/Http/Middleware/ApiAuth.php`
- **ุงูุงุณุชุฎุฏุงู**: `api.auth`
- **ุงููุธููุฉ**: ุงูุชุญูู ูู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู ููุท
- **ุงูุชุญููุงุช**:
  - ูุฌูุฏ ุงููุณุชุฎุฏู ุงููุณุฌู ุฏุฎููู
  - ุตุญุฉ ุงูู token

#### **2. CheckUserActive**
- **ุงูููู**: `app/Http/Middleware/CheckUserActive.php`
- **ุงูุงุณุชุฎุฏุงู**: `api.user.active`
- **ุงููุธููุฉ**: ุงูุชุญูู ูู ุญุงูุฉ ุงููุณุชุฎุฏู ุงููุดุท
- **ุงูุชุญููุงุช**:
  - ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎููู
  - ุงูุญุณุงุจ ูุดุท (`is_active = true`)
  - ุงูุญุณุงุจ ุบูุฑ ูุญุธูุฑ (`is_banned = false`)
  - ุงูุญุณุงุจ ุบูุฑ ูุญุฐูู (`deleted_at = null`)

#### **3. ApiAuthAndActive**
- **ุงูููู**: `app/Http/Middleware/ApiAuthAndActive.php`
- **ุงูุงุณุชุฎุฏุงู**: `api.auth.active`
- **ุงููุธููุฉ**: ุงูุชุญูู ูู ุงููุตุงุฏูุฉ ูุญุงูุฉ ุงููุณุชุฎุฏู ูุนุงู
- **ุงูุชุญููุงุช**:
  - ุฌููุน ุชุญููุงุช `ApiAuth`
  - ุฌููุน ุชุญููุงุช `CheckUserActive`

### ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

#### ูู ูููุงุช ุงููุณุงุฑุงุช:

```php
// ููุชุญูู ูู ุงููุตุงุฏูุฉ ููุท
Route::middleware('api.auth')->group(function () {
    // ูุณุงุฑุงุช ุชุญุชุงุฌ ุชุณุฌูู ุฏุฎูู ููุท
});

// ููุชุญูู ูู ุญุงูุฉ ุงููุณุชุฎุฏู ุงููุดุท
Route::middleware('api.user.active')->group(function () {
    // ูุณุงุฑุงุช ุชุญุชุงุฌ ูุณุชุฎุฏู ูุดุท
});

// ููุชุญูู ูู ุงููุตุงุฏูุฉ ูุญุงูุฉ ุงููุณุชุฎุฏู ูุนุงู (ููุตู ุจู)
Route::middleware('api.auth.active')->group(function () {
    // ูุณุงุฑุงุช ุชุญุชุงุฌ ุชุณุฌูู ุฏุฎูู ููุณุชุฎุฏู ูุดุท
});
```

### ๐ ุฑููุฒ ุงูุงุณุชุฌุงุจุฉ

#### **401 Unauthorized**
```json
{
    "status": false,
    "message": "Unauthenticated. Please login first.",
    "code": "UNAUTHENTICATED"
}
```

```json
{
    "status": false,
    "message": "Invalid authentication token.",
    "code": "INVALID_TOKEN"
}
```

#### **403 Forbidden**
```json
{
    "status": false,
    "message": "Your account is deactivated. Please contact support.",
    "code": "ACCOUNT_DEACTIVATED"
}
```

```json
{
    "status": false,
    "message": "Your account has been banned. Please contact support.",
    "code": "ACCOUNT_BANNED"
}
```

```json
{
    "status": false,
    "message": "Your account has been deleted.",
    "code": "ACCOUNT_DELETED"
}
```

### ๐ ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู

#### **API v1 (Legacy)**
```php
// ูุณุชุฎุฏู api.auth ููุท
Route::middleware('api.auth')->group(function () {
    Route::post('/update-profile', [authController::class, 'update']);
});
```

#### **API v2 (Current)**
```php
// ูุณุชุฎุฏู api.auth.active (ููุตู ุจู)
Route::middleware('api.auth.active')->group(function () {
    Route::post('/profile/update', [authController::class, 'update']);
});
```

### ๐ก๏ธ ุงูุฃูุงู

#### **ุงูุชุญููุงุช ุงููุทุจูุฉ:**
1. **ุงููุตุงุฏูุฉ**: ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ุงููุณุฌู ุฏุฎููู
2. **ุตุญุฉ ุงูู Token**: ุงูุชุญูู ูู ุตุญุฉ ุงูู JWT token
3. **ุญุงูุฉ ุงููุดุงุท**: ุงูุชุญูู ูู ุฃู ุงูุญุณุงุจ ูุดุท
4. **ุนุฏู ุงูุญุธุฑ**: ุงูุชุญูู ูู ุฃู ุงูุญุณุงุจ ุบูุฑ ูุญุธูุฑ
5. **ุนุฏู ุงูุญุฐู**: ุงูุชุญูู ูู ุฃู ุงูุญุณุงุจ ุบูุฑ ูุญุฐูู

#### **ุงูุงุณุชุฌุงุจุงุช ุงูุขููุฉ:**
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- ุฑููุฒ ุฎุทุฃ ูุญุฏุฏุฉ ููุชุทุจููุงุช
- ุนุฏู ูุดู ูุนูููุงุช ุญุณุงุณุฉ
- ุงุณุชุฌุงุจุงุช HTTP ุตุญูุญุฉ

### ๐ ุงูุฃุฏุงุก

#### **ุงูุชุญุณููุงุช:**
- ุงุณุชุฎุฏุงู `Auth::guard('api')->check()` ููุฃุฏุงุก ุงูุฃูุซู
- ุงูุชุญูู ูู ุงููุณุชุฎุฏู ูุฑุฉ ูุงุญุฏุฉ ููุท
- ุฅุฑุฌุงุน ุงูุงุณุชุฌุงุจุฉ ููุฑุงู ุนูุฏ ุงููุดู
- ุนุฏู ุชุญููู ุจูุงูุงุช ุบูุฑ ุถุฑูุฑูุฉ

### ๐ง ุงูุชุฎุตูุต

#### **ุฅุถุงูุฉ ุชุญููุงุช ุฌุฏูุฏุฉ:**
```php
// ูู CheckUserActive.php
if ($user->custom_field) {
    return response()->json([
        'status' => false,
        'message' => 'Custom validation failed.',
        'code' => 'CUSTOM_VALIDATION_FAILED'
    ], 403);
}
```

#### **ุชุฎุตูุต ุงูุฑุณุงุฆู:**
```php
// ูููู ุชุฎุตูุต ุงูุฑุณุงุฆู ุญุณุจ ุงููุบุฉ
$message = app()->getLocale() === 'ar' 
    ? 'ุญุณุงุจู ุบูุฑ ูุดุท. ูุฑุฌู ุงูุชูุงุตู ูุน ุงูุฏุนู.'
    : 'Your account is deactivated. Please contact support.';
```

### โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงุณุชุฎุฏู `api.auth.active`** ูููุณุงุฑุงุช ุงูุฌุฏูุฏุฉ
2. **ุงุญุชูุธ ุจู `api.auth`** ูููุณุงุฑุงุช ุงููุฏููุฉ
3. **ุงุฎุชุจุฑ** ุงูู middleware ูู ุจูุฆุฉ ุงูุชุทููุฑ
4. **ูุซู** ุฃู ุชุบููุฑุงุช ุฌุฏูุฏุฉ
5. **ุฑุงูุจ** ุงูุฃุฏุงุก ุนูุฏ ุงูุชุทุจูู

### ๐ ุงูุฏุนู

ูุฃู ุงุณุชูุณุงุฑุงุช ุญูู ุงูู middlewareุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.
